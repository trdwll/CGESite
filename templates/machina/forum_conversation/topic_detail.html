{% extends 'board_base.html' %}
{% load i18n %}
{% load forum_conversation_tags %}
{% load forum_permission_tags %}

{% block sub_title %}{{ topic.subject }}{% endblock sub_title %}

{% block content %}
<section class="pt-lg-5">
	<div class="container">
		<div class="row">
			<div class="col-lg-11 mx-auto">
			{% include "forum_conversation/partials/topic_detail_actions.html" %}
				<div class="card">
					<div class="card-header d-flex align-items-center px-3 px-md-4">
						<h6 class="card-title">{{ topic.subject }}</h6>
						{% for post in posts %}
						{% if forloop.first %}
						<div class="dropdown ml-auto">
							<button class="btn btn-link p-0" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="ya ya-menu"></i>
							</button>
							<div class="dropdown-menu dropdown-menu-right">
								{% get_permission 'can_edit_post' post request.user as user_can_edit_post %}
								{% if user_can_edit_post %}
								<a class="dropdown-item" href="{% if post.is_topic_head %}{% url 'forum_conversation:topic_update' forum.slug forum.pk topic.slug topic.pk %}{% else %}{% url 'forum_conversation:post_update' forum.slug forum.pk topic.slug topic.pk post.pk %}{% endif %}" title="{% trans "Edit" %}">{% trans "Edit" %}</a>
								{% endif %}
								{% get_permission 'can_delete_post' post request.user as user_can_delete_post %}
								{% if user_can_delete_post %}
								<a class="dropdown-item" href="{% url 'forum_conversation:post_delete' forum.slug forum.pk topic.slug topic.pk post.pk %}" title="{% trans "Delete" %}">{% trans "Delete" %}</a>
								{% endif %}
							</div>
						</div>
					</div>
					<div class="card-body p-3 p-md-4">
						{{ post.content.rendered }}
					</div>
					{% endif %}
					{% endfor %}
				</div>
				<h5 class="mt-5 mb-4">Leave a reply</h5>
				<form class="mb-4">
					<div class="form-group ckeditor">
						<textarea name="content" id="editor">
					&lt;p&gt;Here goes the initial content of the editor.&lt;/p&gt;
				</textarea>
					</div>
					<button type="submit" class="btn btn-primary mt-4">Submit reply</button>
				</form>
			</div>
		</div>
	</div>
</section>
<section class="bg-lighten border-top py-lg-5 px-1 px-md-0">
	<div class="container">
		<div class="row">
			<div class="col-lg-11 mx-auto">
				<div id="comments" class="comments">
					{% comment %} <div class="d-flex align-items-center mb-3">
						<div class="dropdown ml-auto">
							<button class="btn btn-light dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Sort by date
							</button>
							<div class="dropdown-menu dropdown-menu-right">
								<a class="dropdown-item active" href="#">Latest</a>
								<a class="dropdown-item" href="#">Oldest</a>
								<a class="dropdown-item" href="#">Best</a>
								<a class="dropdown-item" href="#">Random</a>
							</div>
						</div>
					</div> {% endcomment %}
					{% if not request.user.is_authenticated %}
					<div class="alert alert-primary">
						Please login to submit a reply under this post!
					</div>
					{% endif %}

					{% for post in posts %}
					{% if forloop.first and post.is_topic_head and poll %}
					{% include "forum_conversation/forum_polls/poll_detail.html" %}
					{% endif %}
					
					{% if not forloop.first %}
					<div class="media">
						{% comment %} <div class="avatar avatar-badge">
							<img src="/static/img/user-2.jpg" alt="Venom">
						</div> {% endcomment %}
						<div class="media-body">
							<div class="d-flex">
								<div class="d-flex">
							{% if post.poster %}
								{% url 'forum_member:profile' post.poster_id as poster_url %}
								{% blocktrans trimmed with poster_url=poster_url username=post.poster.username creation_date=post.created %}
									<a class="h6" href="{{Â poster_url }}">{{ username }}</a>
									<div class="media-meta">{{ creation_date }}</div>
								{% endblocktrans %}
								{% else %}
								{% blocktrans trimmed with poster_username=post.username creation_date=post.created %}
									{{ poster_username }}
									<div class="media-meta">{{ creation_date }}</div>
								{% endblocktrans %}
								{% endif %}
								</div>
								<div class="media-tools">
								{% get_permission 'can_edit_post' post request.user as user_can_edit_post %}
								{% if user_can_edit_post %}
								<a href="{% if post.is_topic_head %}{% url 'forum_conversation:topic_update' forum.slug forum.pk topic.slug topic.pk %}{% else %}{% url 'forum_conversation:post_update' forum.slug forum.pk topic.slug topic.pk post.pk %}{% endif %}" title="{% trans "Edit" %}"><i class="fa fa-edit"></i></a>
								{% endif %}
								{% get_permission 'can_delete_post' post request.user as user_can_delete_post %}
								{% if user_can_delete_post %}
								<a href="{% url 'forum_conversation:post_delete' forum.slug forum.pk topic.slug topic.pk post.pk %}" title="{% trans "Delete" %}"><i class="fa fa-times"></i></a>
								{% endif %}
								</div>
							</div>
							<p>{{ post.content.rendered }}</p>
							{% comment %} <div class="d-flex align-items-center">
								<button class="btn btn-default btn-xs mr-2">Reply</button>
								<button class="btn btn-default btn-xs"><i class="ya ya-like ml-0"></i> (15)</button>
							</div> {% endcomment %}
						</div>
					</div>
					{% endif %}

					{% endfor %}
				</div>
				{% with "pagination-sm" as pagination_size %}
					{% include "partials/pagination.html" %}
				{% endwith %}
			</div>
		</div>
	</div>
</section>
{% endblock content %}
